<!DOCTYPE html>
<meta charset="utf-8">
<head>
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <script src="//d3js.org/d3.v3.min.js"></script>
  <script src="//d3js.org/d3.geo.projection.v0.min.js"></script>
  <script src="//d3js.org/topojson.v1.min.js"></script>
  <!-- I recommend you host this file on your own, since this will change without warning -->
  <script src="https://datamaps.github.io/scripts/datamaps.world.min.js?v=1"></script>
  <title>Bodegas of the World</title>
  <h1> Bodegas of the World</h1>
  <div class="siteBox">
  <div id="bodegaDiv">
<!--     <h1> Test!</h1>  -->
    <p id="testPara">
      Lorem ipsum something about everyone needs a place to run out and get a drink and snack.
    </p>
       </div>
  <div id="mapBox">
  <div id="worldMap" style="position: relative;"></div>
  </div>
  </div>
  <!-- Add as many pattern definitions (defs) as you'd like, make sure to include an ID -->
<svg xmlns="http://www.w3.org/2000/svg" version="1.1"
     xmlns:xlink="http://www.w3.org/1999/xlink">

       
    <!-- Horizontal Stripe pattern -->
    <defs>
        <pattern id="horizontal-stripe"
                 width="4" height="4"
                 patternunits="userSpaceOnUse">
             <line x1="0" y1="2" x2="4" y2="2" stroke="blue" />
        </pattern>
    </defs>
       
       
      <!-- Vertical Stripe pattern -->   
    <defs>
        <pattern id="vertical-stripe"
                 width="4" height="4"
                 patternunits="userSpaceOnUse">
             <line x1="2" y1="0" x2="2" y2="4" stroke="green" />
        </pattern>
    </defs>
    
     <!-- Diagonal Stripe pattern -->
    <defs>
        <pattern id="diagonal-stripe"
                 patterntransform="rotate(45)"
                 width="4" height="4"
                 patternunits="userSpaceOnUse">
             <line x1="2" y1="0" x2="2" y2="4" stroke="#bada55" stroke-width="2" />
        </pattern>
    </defs>

      <!-- Circles pattern --> 
    <defs>
        <pattern id="circles"
                 width="4" height="4"
                 patternunits="userSpaceOnUse">
                   <circle cx="2.5" cy="2.5" r="1.3" fill="green" />
      </pattern>
    </defs>
      
       <!-- Gradient pattern. Wouldn't really recommend this one. -->
     <lineargradient id="gradient">
        <stop offset="5%" stop-color="#F60" />
        <stop offset="95%" stop-color="#FF6" />
     </lineargradient>
       
     <!-- Triangles pattern -->  
     <pattern id="triangle"
       width="8" height="8"
       patternunits="userSpaceOnUse">
         <polygon points="3,0 6,6 0,6" fill="purple"/>
      </pattern>
</svg>
     
     <script>
      var elem = document.querySelector('#testPara');
       var width = 700,
          height = 500;
      //var aitoff = d3.geoAitoff();
      //var mollweide = d3.geo.mollweide().scale(100);
      //var mollweide = d3.geoMollweide().translate([map_width / 2 - .5, map_height / 2 - .5]).scale(90);
       
      var election = new Datamap({
        scope: 'world',
        element: document.getElementById('worldMap'),
        // projection: 
        setProjection: function (element, options){
              var projection = d3.geo.mollweide()
                  .scale(150)
                  .translate([width / 2, height / 2])
                  .precision(.1);
              var path = d3.geo.path().projection(projection);
              return { path: path, projection: projection };
              console.log('test');
        },
        fills: {
          //defaultFill: '#f0af0a',
          defaultFill: 'url(#horizontal-stripe)',
          horizontalStripe: 'url(#horizontal-stripe)',
          diagonalStripe: 'url(#diagonal-stripe)',
          verticalStripe: 'url(#vertical-stripe)',
          circles: 'url(#circles)',
          gradient: 'url(#gradient)',
          triangle: 'url(#triangle)'
        },
        
            // dataUrl: 'country_data.csv',
            // dataType: 'csv', //using a CSV is not working properly.
        data: {
          ATA: {fillKey: 'verticalStripe',
                bodegaStatus: 'No known bodegas.',
                bodegaImage: 'https://cdn.glitch.com/23fa8cec-e81a-4213-bfab-85d4d2ae92d0%2Fantartica.jpg?1544268460570'},
          USA: {fillKey: 'gradient',
                bodegaStatus: 'Observed',
                bodegaImage: 'https://cdn.glitch.com/23fa8cec-e81a-4213-bfab-85d4d2ae92d0%2Fmanhattan.jpeg?1544262342716'},
          CAN: {fillKey: 'gradient',
                bodegaStatus: 'Observed',
                bodegaImage: 'https://cdn.glitch.com/23fa8cec-e81a-4213-bfab-85d4d2ae92d0%2FIMG_6592.JPG?1544134120235'},
          JPN: {fillKey: 'gradient',
                bodegaStatus: 'Observed',
                bodegaImage: 'https://cdn.glitch.com/23fa8cec-e81a-4213-bfab-85d4d2ae92d0%2Fjapan.jpeg?1544262068597'
          },
          MEX: {fillKey: 'gradient',
                bodegaStatus: 'Observed',
                bodegaImage: 'https://cdn.glitch.com/23fa8cec-e81a-4213-bfab-85d4d2ae92d0%2FIMG_7032.JPG?1544166743907'},
          GTM: {fillKey: 'gradient',
                bodegaStatus: 'Observed',
                bodegaImage: 'https://cdn.glitch.com/23fa8cec-e81a-4213-bfab-85d4d2ae92d0%2FIMG_2992.JPG?1544134122129'},
          ARG: {fillKey: 'gradient',
                bodegaStatus: 'Observed',
                bodegaImage: 'https://cdn.glitch.com/23fa8cec-e81a-4213-bfab-85d4d2ae92d0%2FIMG_3967.JPG?1544134109943'},
          MAR: {fillKey: 'gradient',
                bodegaStatus: 'Observed',
                bodegaImage: 'https://cdn.glitch.com/23fa8cec-e81a-4213-bfab-85d4d2ae92d0%2FIMG_5389.JPG?1544134138327'},
          DEU: {fillKey: 'gradient',
                bodegaStatus: 'Observed',
                bodegaImage: 'https://cdn.glitch.com/23fa8cec-e81a-4213-bfab-85d4d2ae92d0%2Fgermany.JPG?1544262480146'},
          CZE: {fillKey: 'gradient',
                bodegaStatus: 'Observed',
                bodegaImage: 'https://cdn.glitch.com/23fa8cec-e81a-4213-bfab-85d4d2ae92d0%2FIMG_9557.JPG?1544166923546'},
          ESP: {fillKey: 'gradient',
                bodegaStatus: 'Observed',
               bodegaImage: 'https://cdn.glitch.com/23fa8cec-e81a-4213-bfab-85d4d2ae92d0%2FIMG_5676.JPG?1544134144594'},
          IND: {fillKey: 'gradient',
                bodegaStatus: 'Observed',
               bodegaImage: 'https://cdn.glitch.com/23fa8cec-e81a-4213-bfab-85d4d2ae92d0%2FIMG_5418.JPG?1544167165812'},
          ZAF: {fillKey: 'gradient',
                bodegaStatus: 'Observed',
                bodegaImage: 'https://cdn.glitch.com/23fa8cec-e81a-4213-bfab-85d4d2ae92d0%2Fsouthafrica.jpg?1544262098413'}
          // RUS: {fillKey: 'verticalStripe' },
          // BRA: {fillKey: 'circles' },
          // GRL: {fillKey: 'gradient'},
          // CHN: {fillKey: 'triangle' }
          
        },
         geographyConfig: {
         hideAntarctica: false,
         popupTemplate: function(geo, data) {
                if(!data){
                        return ['<div class="hoverinfo"><strong>',
                        //The status is not working, it's making the name thing null for all of them that don't have a status. 
                        geo.properties.name, ' ', '</strong><br>' + 'Not yet observed.' +
                        '</div>'].join('');
                } else {
                return ['<div class="hoverinfo"><strong>',
                        //The status is not working, it's making the name thing null for all of them that don't have a status. 
                        geo.properties.name + ' ' + '</strong><br>' + data.bodegaStatus, 
                        '</div>'].join('');
                }
      }
      },
        //The below puts the bodega image in the box if the country has a bodega image.
        done: function(datamap) {
        var html = elem.innerHTML;
        datamap.svg.selectAll('.datamaps-subunit').on('click', function(geography, data) {
          if(!datamap.options.data[geography.id]) {
            elem.innerHTML = 'Not yet observed; please contribute a photo of a corner store if you have one!'
          } else {
            var countryData = datamap.options.data
            var countryID = geography.id
            var countryImage = countryData[countryID].bodegaImage
            elem.innerHTML = "<img src=" + countryImage + "alt='Another Bodega'height='200' width='200'>"
          }
        })}
});

           </script>
</body>

 <!-- All Credit to: https://web.archive.org/web/20150625160038/http://datamaps.markmarkoh.com/custom-fill-patterns-for-datamaps/  -->
<!-- Put the images in the left of the map, or top of the map on mobile. Organize code to map it easy to make this the X of the world. -->
<!-- color fill should then depend on whether there is an asset with that given name. -->